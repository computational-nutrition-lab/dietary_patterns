"Vegetables",             "Fats",
"Sweets&\nBeverages"),
hilightcolors=  c('lightblue',              'firebrick1',        # Add 9 colors for highlighting each L1.
'orange',                 'royalblue',
'gold',                   'darkorchid',
'seagreen',               'lightgreen',
'rosybrown1'),
L1labelcolors=  c('lightblue4',             'firebrick',         # Add 9 colors for annotating each L1.
'darkorange',            'darkblue',
'gold4',                 'darkorchid',
'seagreen',               'limegreen',
'mediumvioletred'))
# Take only the rows that are L1 and find their nodenumbers in order to annotate nodes.
L1s <- subset(nodelabelsdf, level=='L1')
# Make a reference table of the full node names and shorter node names.
L1sref <- data.frame(nodelabels = L1s$nodelabels,
shortnodelabels=c("Milks",                  "Meats",
"Eggs",                   "Legumes",
"Grains",                 "Fruits",
"Vegetables",             "Fats",
"Sweets&\nBeverages"),
hilightcolors=  c('lightblue',              'firebrick1',        # Add 9 colors for highlighting each L1.
'orange',                 'royalblue',
'gold',                   'darkorchid',
'seagreen',               'lightgreen',
'rosybrown1'),
L1labelcolors=  c('lightblue4',             'firebrick',         # Add 9 colors for annotating each L1.
'darkorange',            'darkblue',
'gold4',                 'darkorchid',
'seagreen',               'limegreen',
'mediumvioletred'))
L1sref
# Merge the shortnodelabels to L1s
merged1 <- merge(x=L1s, y=L1sref, all.x=T, by='nodelabels') # all.x=T ignores items in y that is missing in x.
# Function to do some prep for plotting L1 labels.
# Do some preparation to highlight and annotate.
# Save the tip labels as a vector for processing.
PrepFoodTreePlots <- function(tree=tree){
tiplabels <<- tree[["tip.label"]]
length(tiplabels)  # 134 food items = tips for VVKAJ.
# Make the nodes (root, L1s and L2s and so on) into a dataframe.
nodelabels <<- tree[["node.label"]]
length(nodelabels) # 42 = 1 root + 41 L1s&L2s.
nodelabelsdf <<- data.frame(nodelabels= nodelabels,
level= substr(nodelabels, 1,2), # Take the 1st and 2nd characters from nodelabels.
seqnum= seq(1:length(nodelabels)),
nodenum= seq(1:length(nodelabels))+length(tiplabels)  # This corresponds to the node numbers in the plot.
)
# Replace 'fo' to 'root'
nodelabelsdf[1, 2] <- 'root'
# Take only the rows that are L1 and find their nodenumbers in order to annotate nodes.
L1s <<- subset(nodelabelsdf, level=='L1')
# This should have 9 rows if all L1 levels are present in your dataset.
# if for some reason there are not 9, need to decrease the number of colors specified below.
# Make a reference table of the full node names and shorter node names.
L1sref <<- data.frame(nodelabels = L1s$nodelabels,
shortnodelabels=c("Milks",                  "Meats",
"Eggs",                   "Legumes",
"Grains",                 "Fruits",
"Vegetables",             "Fats",
"Sweets&\nBeverages"),
hilightcolors=  c('lightblue',              'firebrick1',        # Add 9 colors for highlighting each L1.
'orange',                 'royalblue',
'gold',                   'darkorchid',
'seagreen',               'lightgreen',
'rosybrown1'),
L1labelcolors=  c('lightblue4',             'firebrick',         # Add 9 colors for annotating each L1.
'darkorange',            'darkblue',
'gold4',                 'darkorchid',
'seagreen',               'limegreen',
'mediumvioletred'))
# Merge the shortnodelabels to L1s
merged1 <<- merge(x=L1s, y=L1sref, all.x=T, by='nodelabels') # all.x=T ignores items in y that is missing in x.
# merge() sorts rows automatically, so need to re-sort it to the original order - by seqnum.
# and sort the columns also so that nodelabels (column 1) and shortnodelabels (column 5) will be next to each other.
L1s <<- merged1[order(merged1$seqnum), c(1,5,2:4,6:7)]
# Make vectors for plotting.
L1nodenum       <<- L1s$nodenum
L1nodelabels    <<- L1s$shortnodelabels
L1hilightcolors <<- L1s$hilightcolors
L1labelcolors   <<- L1s$L1labelcolors
}
# ========================================================================================
# Load source scripts
# ========================================================================================
source("lib/viz_food_tree.r")
# ---------------------------------------------------------------------------------------------------------------
# Prepare node labels of L1 for plotting.
PrepFoodTreePlots(tree=tree)
is(tree)
# Function to do some prep for plotting L1 labels.
# Do some preparation to highlight and annotate.
# Save the tip labels as a vector for processing.
PrepFoodTreePlots <- function(input.tree=tree){
tiplabels <<- tree[["tip.label"]]
length(tiplabels)  # 134 food items = tips for VVKAJ.
# Make the nodes (root, L1s and L2s and so on) into a dataframe.
nodelabels <<- tree[["node.label"]]
length(nodelabels) # 42 = 1 root + 41 L1s&L2s.
nodelabelsdf <<- data.frame(nodelabels= nodelabels,
level= substr(nodelabels, 1,2), # Take the 1st and 2nd characters from nodelabels.
seqnum= seq(1:length(nodelabels)),
nodenum= seq(1:length(nodelabels))+length(tiplabels)  # This corresponds to the node numbers in the plot.
)
# Replace 'fo' to 'root'
nodelabelsdf[1, 2] <- 'root'
# Take only the rows that are L1 and find their nodenumbers in order to annotate nodes.
L1s <<- subset(nodelabelsdf, level=='L1')
# This should have 9 rows if all L1 levels are present in your dataset.
# if for some reason there are not 9, need to decrease the number of colors specified below.
# Make a reference table of the full node names and shorter node names.
L1sref <<- data.frame(nodelabels = L1s$nodelabels,
shortnodelabels=c("Milks",                  "Meats",
"Eggs",                   "Legumes",
"Grains",                 "Fruits",
"Vegetables",             "Fats",
"Sweets&\nBeverages"),
hilightcolors=  c('lightblue',              'firebrick1',        # Add 9 colors for highlighting each L1.
'orange',                 'royalblue',
'gold',                   'darkorchid',
'seagreen',               'lightgreen',
'rosybrown1'),
L1labelcolors=  c('lightblue4',             'firebrick',         # Add 9 colors for annotating each L1.
'darkorange',            'darkblue',
'gold4',                 'darkorchid',
'seagreen',               'limegreen',
'mediumvioletred'))
# Merge the shortnodelabels to L1s
merged1 <<- merge(x=L1s, y=L1sref, all.x=T, by='nodelabels') # all.x=T ignores items in y that is missing in x.
# merge() sorts rows automatically, so need to re-sort it to the original order - by seqnum.
# and sort the columns also so that nodelabels (column 1) and shortnodelabels (column 5) will be next to each other.
L1s <<- merged1[order(merged1$seqnum), c(1,5,2:4,6:7)]
# Make vectors for plotting.
L1nodenum       <<- L1s$nodenum
L1nodelabels    <<- L1s$shortnodelabels
L1hilightcolors <<- L1s$hilightcolors
L1labelcolors   <<- L1s$L1labelcolors
}
# ---------------------------------------------------------------------------------------------------------------
# Prepare node labels of L1 for plotting.
PrepFoodTreePlots(tree=tree)
# ---------------------------------------------------------------------------------------------------------------
# Prepare node labels of L1 for plotting.
PrepFoodTreePlots(input.tree=tree)
L1nodenum
tree_an_hi <- ggtree(tree, ladderize = F, layout = 'radial') +
# geom_text(aes(label=node), hjust= -0.3) +
geom_hilight(   node=L1nodenum[1],  fill=L1hilightcolors[1]) +  # Milk products
geom_cladelabel(node=L1nodenum[1], color=  L1labelcolors[1], label=L1nodelabels[1], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[2],  fill=L1hilightcolors[2]) +  # Meat & fish
geom_cladelabel(node=L1nodenum[2], color=  L1labelcolors[2], label=L1nodelabels[2], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[3],  fill=L1hilightcolors[3]) +  # Eggs
geom_cladelabel(node=L1nodenum[3], color=  L1labelcolors[3], label=L1nodelabels[3], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[4],  fill=L1hilightcolors[4]) +  # Legumes, nuts & seeds
geom_cladelabel(node=L1nodenum[4], color=  L1labelcolors[4], label=L1nodelabels[4], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[5],  fill=L1hilightcolors[5]) +  # Grain products
geom_cladelabel(node=L1nodenum[5], color=  L1labelcolors[5], label=L1nodelabels[5], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[6],  fill=L1hilightcolors[6]) +  # Fruits
geom_cladelabel(node=L1nodenum[6], color=  L1labelcolors[6], label=L1nodelabels[6], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[7],  fill=L1hilightcolors[7]) +  # Vegetables
geom_cladelabel(node=L1nodenum[7], color=  L1labelcolors[7], label=L1nodelabels[7], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[8],  fill=L1hilightcolors[8]) +  # Fats & oils
geom_cladelabel(node=L1nodenum[8], color=  L1labelcolors[8], label=L1nodelabels[8], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[9],  fill=L1hilightcolors[9]) +  # Sweets & beverages
geom_cladelabel(node=L1nodenum[9], color=  L1labelcolors[9], label=L1nodelabels[9], offset=0.5, geom="label", fill='white', hjust=0.5) +
tree_an_hi
tree_an_hi <- ggtree(tree, ladderize = F, layout = 'radial') +
# geom_text(aes(label=node), hjust= -0.3) +
geom_hilight(   node=L1nodenum[1],  fill=L1hilightcolors[1]) +  # Milk products
geom_cladelabel(node=L1nodenum[1], color=  L1labelcolors[1], label=L1nodelabels[1], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[2],  fill=L1hilightcolors[2]) +  # Meat & fish
geom_cladelabel(node=L1nodenum[2], color=  L1labelcolors[2], label=L1nodelabels[2], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[3],  fill=L1hilightcolors[3]) +  # Eggs
geom_cladelabel(node=L1nodenum[3], color=  L1labelcolors[3], label=L1nodelabels[3], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[4],  fill=L1hilightcolors[4]) +  # Legumes, nuts & seeds
geom_cladelabel(node=L1nodenum[4], color=  L1labelcolors[4], label=L1nodelabels[4], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[5],  fill=L1hilightcolors[5]) +  # Grain products
geom_cladelabel(node=L1nodenum[5], color=  L1labelcolors[5], label=L1nodelabels[5], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[6],  fill=L1hilightcolors[6]) +  # Fruits
geom_cladelabel(node=L1nodenum[6], color=  L1labelcolors[6], label=L1nodelabels[6], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[7],  fill=L1hilightcolors[7]) +  # Vegetables
geom_cladelabel(node=L1nodenum[7], color=  L1labelcolors[7], label=L1nodelabels[7], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[8],  fill=L1hilightcolors[8]) +  # Fats & oils
geom_cladelabel(node=L1nodenum[8], color=  L1labelcolors[8], label=L1nodelabels[8], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[9],  fill=L1hilightcolors[9]) +  # Sweets & beverages
geom_cladelabel(node=L1nodenum[9], color=  L1labelcolors[9], label=L1nodelabels[9], offset=0.5, geom="label", fill='white', hjust=0.5)
tree_an_hi
VizFoodTree <- function(input.tree=tree, layout= c("radial", "circular")){
tree_an_hi <- ggtree(input.tree, ladderize=F, layout = layout) +
# geom_text(aes(label=node), hjust= -0.3) +
geom_hilight(   node=L1nodenum[1],  fill=L1hilightcolors[1]) +  # Milk products
geom_cladelabel(node=L1nodenum[1], color=  L1labelcolors[1], label=L1nodelabels[1], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[2],  fill=L1hilightcolors[2]) +  # Meat & fish
geom_cladelabel(node=L1nodenum[2], color=  L1labelcolors[2], label=L1nodelabels[2], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[3],  fill=L1hilightcolors[3]) +  # Eggs
geom_cladelabel(node=L1nodenum[3], color=  L1labelcolors[3], label=L1nodelabels[3], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[4],  fill=L1hilightcolors[4]) +  # Legumes, nuts & seeds
geom_cladelabel(node=L1nodenum[4], color=  L1labelcolors[4], label=L1nodelabels[4], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[5],  fill=L1hilightcolors[5]) +  # Grain products
geom_cladelabel(node=L1nodenum[5], color=  L1labelcolors[5], label=L1nodelabels[5], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[6],  fill=L1hilightcolors[6]) +  # Fruits
geom_cladelabel(node=L1nodenum[6], color=  L1labelcolors[6], label=L1nodelabels[6], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[7],  fill=L1hilightcolors[7]) +  # Vegetables
geom_cladelabel(node=L1nodenum[7], color=  L1labelcolors[7], label=L1nodelabels[7], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[8],  fill=L1hilightcolors[8]) +  # Fats & oils
geom_cladelabel(node=L1nodenum[8], color=  L1labelcolors[8], label=L1nodelabels[8], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[9],  fill=L1hilightcolors[9]) +  # Sweets & beverages
geom_cladelabel(node=L1nodenum[9], color=  L1labelcolors[9], label=L1nodelabels[9], offset=0.5, geom="label", fill='white', hjust=0.5)
}
VizFoodTree <- function(input.tree=tree, layout= c("radial", "circular", output.name)){
tree_an_hi <- ggtree(input.tree, ladderize=F, layout = layout) +
# geom_text(aes(label=node), hjust= -0.3) +
geom_hilight(   node=L1nodenum[1],  fill=L1hilightcolors[1]) +  # Milk products
geom_cladelabel(node=L1nodenum[1], color=  L1labelcolors[1], label=L1nodelabels[1], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[2],  fill=L1hilightcolors[2]) +  # Meat & fish
geom_cladelabel(node=L1nodenum[2], color=  L1labelcolors[2], label=L1nodelabels[2], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[3],  fill=L1hilightcolors[3]) +  # Eggs
geom_cladelabel(node=L1nodenum[3], color=  L1labelcolors[3], label=L1nodelabels[3], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[4],  fill=L1hilightcolors[4]) +  # Legumes, nuts & seeds
geom_cladelabel(node=L1nodenum[4], color=  L1labelcolors[4], label=L1nodelabels[4], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[5],  fill=L1hilightcolors[5]) +  # Grain products
geom_cladelabel(node=L1nodenum[5], color=  L1labelcolors[5], label=L1nodelabels[5], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[6],  fill=L1hilightcolors[6]) +  # Fruits
geom_cladelabel(node=L1nodenum[6], color=  L1labelcolors[6], label=L1nodelabels[6], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[7],  fill=L1hilightcolors[7]) +  # Vegetables
geom_cladelabel(node=L1nodenum[7], color=  L1labelcolors[7], label=L1nodelabels[7], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[8],  fill=L1hilightcolors[8]) +  # Fats & oils
geom_cladelabel(node=L1nodenum[8], color=  L1labelcolors[8], label=L1nodelabels[8], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[9],  fill=L1hilightcolors[9]) +  # Sweets & beverages
geom_cladelabel(node=L1nodenum[9], color=  L1labelcolors[9], label=L1nodelabels[9], offset=0.5, geom="label", fill='white', hjust=0.5)
output.name <<- tree_an_hi
}
VizFoodTree(input.tree=tree, layout="circular", output.name="mytree_an_hi")
VizFoodTree <- function(input.tree=tree, layout= c("radial", "circular"), output.name){
tree_an_hi <- ggtree(input.tree, ladderize=F, layout = layout) +
# geom_text(aes(label=node), hjust= -0.3) +
geom_hilight(   node=L1nodenum[1],  fill=L1hilightcolors[1]) +  # Milk products
geom_cladelabel(node=L1nodenum[1], color=  L1labelcolors[1], label=L1nodelabels[1], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[2],  fill=L1hilightcolors[2]) +  # Meat & fish
geom_cladelabel(node=L1nodenum[2], color=  L1labelcolors[2], label=L1nodelabels[2], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[3],  fill=L1hilightcolors[3]) +  # Eggs
geom_cladelabel(node=L1nodenum[3], color=  L1labelcolors[3], label=L1nodelabels[3], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[4],  fill=L1hilightcolors[4]) +  # Legumes, nuts & seeds
geom_cladelabel(node=L1nodenum[4], color=  L1labelcolors[4], label=L1nodelabels[4], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[5],  fill=L1hilightcolors[5]) +  # Grain products
geom_cladelabel(node=L1nodenum[5], color=  L1labelcolors[5], label=L1nodelabels[5], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[6],  fill=L1hilightcolors[6]) +  # Fruits
geom_cladelabel(node=L1nodenum[6], color=  L1labelcolors[6], label=L1nodelabels[6], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[7],  fill=L1hilightcolors[7]) +  # Vegetables
geom_cladelabel(node=L1nodenum[7], color=  L1labelcolors[7], label=L1nodelabels[7], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[8],  fill=L1hilightcolors[8]) +  # Fats & oils
geom_cladelabel(node=L1nodenum[8], color=  L1labelcolors[8], label=L1nodelabels[8], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[9],  fill=L1hilightcolors[9]) +  # Sweets & beverages
geom_cladelabel(node=L1nodenum[9], color=  L1labelcolors[9], label=L1nodelabels[9], offset=0.5, geom="label", fill='white', hjust=0.5)
output.name <<- tree_an_hi
}
VizFoodTree(input.tree=tree, layout="circular", output.name="mytree_an_hi")
mytree_an_hi
VizFoodTree(input.tree=tree, layout="circular", output.name=mytree_an_hi)
mytree_an_hi
VizFoodTree <- function(input.tree=tree, layout= c("radial", "circular"), output.name){
tree_an_hi <- ggtree(input.tree, ladderize=F, layout = layout) +
# geom_text(aes(label=node), hjust= -0.3) +
geom_hilight(   node=L1nodenum[1],  fill=L1hilightcolors[1]) +  # Milk products
geom_cladelabel(node=L1nodenum[1], color=  L1labelcolors[1], label=L1nodelabels[1], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[2],  fill=L1hilightcolors[2]) +  # Meat & fish
geom_cladelabel(node=L1nodenum[2], color=  L1labelcolors[2], label=L1nodelabels[2], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[3],  fill=L1hilightcolors[3]) +  # Eggs
geom_cladelabel(node=L1nodenum[3], color=  L1labelcolors[3], label=L1nodelabels[3], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[4],  fill=L1hilightcolors[4]) +  # Legumes, nuts & seeds
geom_cladelabel(node=L1nodenum[4], color=  L1labelcolors[4], label=L1nodelabels[4], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[5],  fill=L1hilightcolors[5]) +  # Grain products
geom_cladelabel(node=L1nodenum[5], color=  L1labelcolors[5], label=L1nodelabels[5], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[6],  fill=L1hilightcolors[6]) +  # Fruits
geom_cladelabel(node=L1nodenum[6], color=  L1labelcolors[6], label=L1nodelabels[6], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[7],  fill=L1hilightcolors[7]) +  # Vegetables
geom_cladelabel(node=L1nodenum[7], color=  L1labelcolors[7], label=L1nodelabels[7], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[8],  fill=L1hilightcolors[8]) +  # Fats & oils
geom_cladelabel(node=L1nodenum[8], color=  L1labelcolors[8], label=L1nodelabels[8], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[9],  fill=L1hilightcolors[9]) +  # Sweets & beverages
geom_cladelabel(node=L1nodenum[9], color=  L1labelcolors[9], label=L1nodelabels[9], offset=0.5, geom="label", fill='white', hjust=0.5)
output.name # <<- tree_an_hi
}
VizFoodTree(input.tree=tree, layout="circular", output.name=mytree_an_hi)
VizFoodTree <- function(input.tree=tree, layout= c("radial", "circular"), output.name){
tree_an_hi <- ggtree(input.tree, ladderize=F, layout = layout) +
# geom_text(aes(label=node), hjust= -0.3) +
geom_hilight(   node=L1nodenum[1],  fill=L1hilightcolors[1]) +  # Milk products
geom_cladelabel(node=L1nodenum[1], color=  L1labelcolors[1], label=L1nodelabels[1], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[2],  fill=L1hilightcolors[2]) +  # Meat & fish
geom_cladelabel(node=L1nodenum[2], color=  L1labelcolors[2], label=L1nodelabels[2], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[3],  fill=L1hilightcolors[3]) +  # Eggs
geom_cladelabel(node=L1nodenum[3], color=  L1labelcolors[3], label=L1nodelabels[3], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[4],  fill=L1hilightcolors[4]) +  # Legumes, nuts & seeds
geom_cladelabel(node=L1nodenum[4], color=  L1labelcolors[4], label=L1nodelabels[4], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[5],  fill=L1hilightcolors[5]) +  # Grain products
geom_cladelabel(node=L1nodenum[5], color=  L1labelcolors[5], label=L1nodelabels[5], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[6],  fill=L1hilightcolors[6]) +  # Fruits
geom_cladelabel(node=L1nodenum[6], color=  L1labelcolors[6], label=L1nodelabels[6], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[7],  fill=L1hilightcolors[7]) +  # Vegetables
geom_cladelabel(node=L1nodenum[7], color=  L1labelcolors[7], label=L1nodelabels[7], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[8],  fill=L1hilightcolors[8]) +  # Fats & oils
geom_cladelabel(node=L1nodenum[8], color=  L1labelcolors[8], label=L1nodelabels[8], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[9],  fill=L1hilightcolors[9]) +  # Sweets & beverages
geom_cladelabel(node=L1nodenum[9], color=  L1labelcolors[9], label=L1nodelabels[9], offset=0.5, geom="label", fill='white', hjust=0.5)
output.name <<- tree_an_hi
}
VizFoodTree(input.tree=tree, layout="circular", output.name=mytree_an_hi)
mytree_an_hi
VizFoodTree <- function(input.tree=tree, layout= c("radial", "circular"), output.name){
tree_an_hi <- ggtree(input.tree, ladderize=F, layout = layout) +
# geom_text(aes(label=node), hjust= -0.3) +
geom_hilight(   node=L1nodenum[1],  fill=L1hilightcolors[1]) +  # Milk products
geom_cladelabel(node=L1nodenum[1], color=  L1labelcolors[1], label=L1nodelabels[1], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[2],  fill=L1hilightcolors[2]) +  # Meat & fish
geom_cladelabel(node=L1nodenum[2], color=  L1labelcolors[2], label=L1nodelabels[2], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[3],  fill=L1hilightcolors[3]) +  # Eggs
geom_cladelabel(node=L1nodenum[3], color=  L1labelcolors[3], label=L1nodelabels[3], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[4],  fill=L1hilightcolors[4]) +  # Legumes, nuts & seeds
geom_cladelabel(node=L1nodenum[4], color=  L1labelcolors[4], label=L1nodelabels[4], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[5],  fill=L1hilightcolors[5]) +  # Grain products
geom_cladelabel(node=L1nodenum[5], color=  L1labelcolors[5], label=L1nodelabels[5], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[6],  fill=L1hilightcolors[6]) +  # Fruits
geom_cladelabel(node=L1nodenum[6], color=  L1labelcolors[6], label=L1nodelabels[6], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[7],  fill=L1hilightcolors[7]) +  # Vegetables
geom_cladelabel(node=L1nodenum[7], color=  L1labelcolors[7], label=L1nodelabels[7], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[8],  fill=L1hilightcolors[8]) +  # Fats & oils
geom_cladelabel(node=L1nodenum[8], color=  L1labelcolors[8], label=L1nodelabels[8], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[9],  fill=L1hilightcolors[9]) +  # Sweets & beverages
geom_cladelabel(node=L1nodenum[9], color=  L1labelcolors[9], label=L1nodelabels[9], offset=0.5, geom="label", fill='white', hjust=0.5)
list.save(x=tree_an_hi, file=output.name)
}
VizFoodTree(input.tree=tree, layout="circular", output.name=mytree_an_hi)
tree_an_hi <- ggtree(input.tree, ladderize=F, layout = layout) +
# geom_text(aes(label=node), hjust= -0.3) +
geom_hilight(   node=L1nodenum[1],  fill=L1hilightcolors[1]) +  # Milk products
geom_cladelabel(node=L1nodenum[1], color=  L1labelcolors[1], label=L1nodelabels[1], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[2],  fill=L1hilightcolors[2]) +  # Meat & fish
geom_cladelabel(node=L1nodenum[2], color=  L1labelcolors[2], label=L1nodelabels[2], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[3],  fill=L1hilightcolors[3]) +  # Eggs
geom_cladelabel(node=L1nodenum[3], color=  L1labelcolors[3], label=L1nodelabels[3], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[4],  fill=L1hilightcolors[4]) +  # Legumes, nuts & seeds
geom_cladelabel(node=L1nodenum[4], color=  L1labelcolors[4], label=L1nodelabels[4], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[5],  fill=L1hilightcolors[5]) +  # Grain products
geom_cladelabel(node=L1nodenum[5], color=  L1labelcolors[5], label=L1nodelabels[5], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[6],  fill=L1hilightcolors[6]) +  # Fruits
geom_cladelabel(node=L1nodenum[6], color=  L1labelcolors[6], label=L1nodelabels[6], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[7],  fill=L1hilightcolors[7]) +  # Vegetables
geom_cladelabel(node=L1nodenum[7], color=  L1labelcolors[7], label=L1nodelabels[7], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[8],  fill=L1hilightcolors[8]) +  # Fats & oils
geom_cladelabel(node=L1nodenum[8], color=  L1labelcolors[8], label=L1nodelabels[8], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[9],  fill=L1hilightcolors[9]) +  # Sweets & beverages
geom_cladelabel(node=L1nodenum[9], color=  L1labelcolors[9], label=L1nodelabels[9], offset=0.5, geom="label", fill='white', hjust=0.5)
VizFoodTree <- function(input.tree=tree, layout= c("radial", "circular")){
tree_an_hi <- ggtree(input.tree, ladderize=F, layout = layout) +
# geom_text(aes(label=node), hjust= -0.3) +
geom_hilight(   node=L1nodenum[1],  fill=L1hilightcolors[1]) +  # Milk products
geom_cladelabel(node=L1nodenum[1], color=  L1labelcolors[1], label=L1nodelabels[1], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[2],  fill=L1hilightcolors[2]) +  # Meat & fish
geom_cladelabel(node=L1nodenum[2], color=  L1labelcolors[2], label=L1nodelabels[2], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[3],  fill=L1hilightcolors[3]) +  # Eggs
geom_cladelabel(node=L1nodenum[3], color=  L1labelcolors[3], label=L1nodelabels[3], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[4],  fill=L1hilightcolors[4]) +  # Legumes, nuts & seeds
geom_cladelabel(node=L1nodenum[4], color=  L1labelcolors[4], label=L1nodelabels[4], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[5],  fill=L1hilightcolors[5]) +  # Grain products
geom_cladelabel(node=L1nodenum[5], color=  L1labelcolors[5], label=L1nodelabels[5], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[6],  fill=L1hilightcolors[6]) +  # Fruits
geom_cladelabel(node=L1nodenum[6], color=  L1labelcolors[6], label=L1nodelabels[6], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[7],  fill=L1hilightcolors[7]) +  # Vegetables
geom_cladelabel(node=L1nodenum[7], color=  L1labelcolors[7], label=L1nodelabels[7], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[8],  fill=L1hilightcolors[8]) +  # Fats & oils
geom_cladelabel(node=L1nodenum[8], color=  L1labelcolors[8], label=L1nodelabels[8], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[9],  fill=L1hilightcolors[9]) +  # Sweets & beverages
geom_cladelabel(node=L1nodenum[9], color=  L1labelcolors[9], label=L1nodelabels[9], offset=0.5, geom="label", fill='white', hjust=0.5)
}
VizFoodTree(input.tree=tree, layout="circular")
# Look at the color-coded and annotated food tree.
mytree_an_hi
# Look at the color-coded and annotated food tree.
tree_an_hi
# Widen the opening of the tree
tree_an_hi_o <- open_tree(tree_an_hi, 10)
tree_an_hi_o
# Rotate the tree so that the root (break) will come to the bottom
tree_an_hi_o_rt275 <- rotate_tree(tree_an_hi_o, 275) # 270 + 10*0.5
tree_an_hi_o_rt275
VizFoodTree <- function(input.tree=tree, layout= c("radial", "circular")){
tree_an_hi <<- ggtree(input.tree, ladderize=F, layout = layout) +
# geom_text(aes(label=node), hjust= -0.3) +
geom_hilight(   node=L1nodenum[1],  fill=L1hilightcolors[1]) +  # Milk products
geom_cladelabel(node=L1nodenum[1], color=  L1labelcolors[1], label=L1nodelabels[1], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[2],  fill=L1hilightcolors[2]) +  # Meat & fish
geom_cladelabel(node=L1nodenum[2], color=  L1labelcolors[2], label=L1nodelabels[2], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[3],  fill=L1hilightcolors[3]) +  # Eggs
geom_cladelabel(node=L1nodenum[3], color=  L1labelcolors[3], label=L1nodelabels[3], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[4],  fill=L1hilightcolors[4]) +  # Legumes, nuts & seeds
geom_cladelabel(node=L1nodenum[4], color=  L1labelcolors[4], label=L1nodelabels[4], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[5],  fill=L1hilightcolors[5]) +  # Grain products
geom_cladelabel(node=L1nodenum[5], color=  L1labelcolors[5], label=L1nodelabels[5], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[6],  fill=L1hilightcolors[6]) +  # Fruits
geom_cladelabel(node=L1nodenum[6], color=  L1labelcolors[6], label=L1nodelabels[6], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[7],  fill=L1hilightcolors[7]) +  # Vegetables
geom_cladelabel(node=L1nodenum[7], color=  L1labelcolors[7], label=L1nodelabels[7], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[8],  fill=L1hilightcolors[8]) +  # Fats & oils
geom_cladelabel(node=L1nodenum[8], color=  L1labelcolors[8], label=L1nodelabels[8], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[9],  fill=L1hilightcolors[9]) +  # Sweets & beverages
geom_cladelabel(node=L1nodenum[9], color=  L1labelcolors[9], label=L1nodelabels[9], offset=0.5, geom="label", fill='white', hjust=0.5)
# Widen the opening of the tree
tree_an_hi_o <- open_tree(tree_an_hi, 10)
# Rotate the tree so that the root (break) will come to the bottom
tree_an_hi_o_rt <- rotate_tree(tree_an_hi_o, 275) # 270 + 10*0.5
}
# Look at the color-coded and annotated food tree, saved as tree_an_hi_o_rt.
tree_an_hi_o_rt
# Create a color-coded and annotated food tree with 9 L1 levels.
VizFoodTree(input.tree=tree, layout="circular")
# Look at the color-coded and annotated food tree, saved as tree_an_hi_o_rt.
tree_an_hi_o_rt
VizFoodTree <- function(input.tree=tree, layout= c("radial", "circular")){
tree_an_hi <<- ggtree(input.tree, ladderize=F, layout = layout) +
# geom_text(aes(label=node), hjust= -0.3) +
geom_hilight(   node=L1nodenum[1],  fill=L1hilightcolors[1]) +  # Milk products
geom_cladelabel(node=L1nodenum[1], color=  L1labelcolors[1], label=L1nodelabels[1], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[2],  fill=L1hilightcolors[2]) +  # Meat & fish
geom_cladelabel(node=L1nodenum[2], color=  L1labelcolors[2], label=L1nodelabels[2], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[3],  fill=L1hilightcolors[3]) +  # Eggs
geom_cladelabel(node=L1nodenum[3], color=  L1labelcolors[3], label=L1nodelabels[3], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[4],  fill=L1hilightcolors[4]) +  # Legumes, nuts & seeds
geom_cladelabel(node=L1nodenum[4], color=  L1labelcolors[4], label=L1nodelabels[4], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[5],  fill=L1hilightcolors[5]) +  # Grain products
geom_cladelabel(node=L1nodenum[5], color=  L1labelcolors[5], label=L1nodelabels[5], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[6],  fill=L1hilightcolors[6]) +  # Fruits
geom_cladelabel(node=L1nodenum[6], color=  L1labelcolors[6], label=L1nodelabels[6], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[7],  fill=L1hilightcolors[7]) +  # Vegetables
geom_cladelabel(node=L1nodenum[7], color=  L1labelcolors[7], label=L1nodelabels[7], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[8],  fill=L1hilightcolors[8]) +  # Fats & oils
geom_cladelabel(node=L1nodenum[8], color=  L1labelcolors[8], label=L1nodelabels[8], offset=0.5, geom="label", fill='white', hjust=0.5) +
geom_hilight(   node=L1nodenum[9],  fill=L1hilightcolors[9]) +  # Sweets & beverages
geom_cladelabel(node=L1nodenum[9], color=  L1labelcolors[9], label=L1nodelabels[9], offset=0.5, geom="label", fill='white', hjust=0.5)
# Widen the opening of the tree
tree_an_hi_o <<- open_tree(tree_an_hi, 10)
# Rotate the tree so that the root (break) will come to the bottom
tree_an_hi_o_rt <<- rotate_tree(tree_an_hi_o, 275) # 270 + 10*0.5
}
# Create a color-coded and annotated food tree with 9 L1 levels.
VizFoodTree(input.tree=tree, layout="circular")
# Look at the color-coded and annotated food tree, saved as tree_an_hi_o_rt.
tree_an_hi_o_rt
source("lib/Food_tree_scripts/newick.tree.r")
source("lib/Food_tree_scripts/check.db.r")
source("lib/Food_tree_scripts/format.foods.r")
source("lib/Food_tree_scripts/make.food.tree.r")
source("lib/Food_tree_scripts/make.food.otu.r")
source("lib/Food_tree_scripts/make.fiber.otu.r")
source("lib/Food_tree_scripts/make.dhydrt.otu.r")
source("lib/Food_tree_scripts/filter.db.by.diet.records.r")
# Current ASA24 database doesn't have modcodes, so de-duplicate database file,
# replace special characters with _, and create a new FoodID out of foodcode and modcode.
# It leaves all other columns intact.
FormatFoods(input_fn="data/Food_tree_data/all.food.desc.txt", output_fn="data/Food_tree_data/ASA24Database.txt")
# FoodCode and  Main.food.description of additional foods not in ASA24. Format it for use.
FormatFoods(input_fn="data/Food_tree_data/Soylent_codes.txt",   output_fn="data/Food_tree_data/Soylent_codes_formatted.txt")
# Format your items data. Output will be saved as dietrecords.txt.
FormatFoods(input_fn="data/Food_tree_data/Items_to_use.txt", output_fn="data/Food_tree_data/dietrecords.txt", dedupe=F)
# make a food tree with the reduced data.
MakeFoodTree(nodes_fn=         "data/Food_tree_data/NodeLabelsMCT.txt",
food_database_fn= "data/Food_tree_data/MCTdatabase.txt",
addl_foods_fn=    "data/Food_tree_data/Soylent_codes_formatted.txt",
num.levels = 1,
output_taxonomy_fn = "results/Food_tree_results/mct.reduced_1Lv.taxonomy.txt",
output_tree_fn=      "results/Food_tree_results/mct.reduced_1Lv.tree.nwk"
)
# Makes the standard food otu table with data in gram weights of food.
MakeFoodOtu(food_records_fn=  "data/Food_tree_data/dietrecords.txt",
food_record_id =  "X.SampleID",                       # Specify the ID of your participants
food_taxonomy_fn= "results/Food_tree_results/mct.reduced_1Lv.taxonomy.txt",  # Specify your taxonomy file produced by MakeFoodTree.
output_fn =       "results/Food_tree_results/mct.reduced_1Lv.food.otu.txt")  # Name your output otu file.
# Makes a food otu table with data in grams of fiber per food
MakeFiberOtu(food_records_fn=  "data/Food_tree_data/dietrecords.txt",
food_record_id =  "X.SampleID",
food_taxonomy_fn= "results/Food_tree_results/mct.reduced_1Lv.taxonomy.txt",
output_fn =       "results/Food_tree_results/mct.reduced_1Lv.fiber.otu.txt")
# Makes a food otu table as dehydrated grams per kcal
MakeDhydrtOtu(food_records_fn=  "data/Food_tree_data/dietrecords.txt",
food_record_id =  "X.SampleID",
food_taxonomy_fn= "results/Food_tree_results/mct.reduced_1Lv.taxonomy.txt",
output_fn =       "results/Food_tree_results/mct.reduced_1Lv.dhydrt.otu.txt")
tree <- read.tree("output/VVKAJ.reduced_1Lv.tree.nwk")
tree <- read.tree("results/Food_tree_results/mct.reduced_1Lv.tree.nwk")
# Use ggtree to plot the tree. It is critical to have ladderize=F argument to preserve your L1 order.
mytreeplot <- ggtree(tree, ladderize=F, layout = 'radial') + # disable ladderizing (sorting by ggtree, CRITICAL!!!)
geom_tiplab()
mytreeplot
# Show the node numbers only.
ggtree(tree, ladderize = F, layout = 'circular') +
geom_text(aes(label=node), hjust= -0.1)
# ---------------------------------------------------------------------------------------------------------------
# Prepare node labels of L1 for plotting. It assumes that there are 9 L1 levels.
PrepFoodTreePlots(input.tree=tree)
# Create a color-coded and annotated food tree with 9 L1 levels.
VizFoodTree(input.tree=tree, layout="circular")
# Look at the color-coded and annotated food tree, saved as tree_an_hi_o_rt.
tree_an_hi_o_rt
# Create a color-coded and annotated food tree with 9 L1 levels.
VizFoodTree(input.tree=tree, layout="radius")
# Create a color-coded and annotated food tree with 9 L1 levels.
# choose either 'circular' or 'radial' for layout.
VizFoodTree(input.tree=tree, layout="radial")
# Look at the color-coded and annotated food tree, saved as tree_an_hi_o_rt.
tree_an_hi_o_rt
tree_an_hi_o_rt + ggtitle("Level 1")
View(tree_an_hi_o_rt)
