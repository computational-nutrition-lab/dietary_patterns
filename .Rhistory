nrow()
setwd("~/GitHub/dietary_patterns")
# Name your main directory for future use.
main_wd <- file.path(getwd())
# load the necessary packages.
library(phyloseq)
library(ggtree)
library(ggplot2)
library(SASxport)
# Load the distinct 100 colors for use.
distinct100colors <- readRDS("~/GitHub/R_Toolbox/distinct100colors.rda")
# Load the necessary scripts.
source("lib/specify_data_dir.R")
source("lib/unifrac_ordination.R")
source("lib/ggplot2themes.R")
# Set working dir
SpecifyDataDirectory("eg_data/NHANES/Laboratory_data/")
# Food
# Load food OTU table - this is our food OTU data
food <- read.delim("Foodtree/Food_D12_FC_cc_f_males50s_red_Lv4.dhydrt.otu.txt", row.names=1)
# Format the food file and create a otu_table called OTU.
PrepFood(data=food)
# Take a look at the food file.
# The column name of "food" is SEQN preceded with an 'X'.
food[1:8, 1:8]
# Taxonomy (tax)
# Load taxonomy file generated by the MakeFoodTree function.
tax <- read.delim("Foodtree/Food_D12_FC_cc_f_males50s_red_Lv4.taxonomy.txt")
# Format the tax file and create a taxonomy table called TAX.
PrepTax(data=tax)
# Sample
# Load the demographics data.
demog <- read.xport("../Raw_data/DEMO_I.XPT")
# Load a dataset that has the "GLU_index" information.
glu <- read.delim( file="QCtotal_d_glu_body_meta.txt", sep= "\t", header= T )
# Take out only the SEQN and GLU_index.
SEQN_GLU <- glu[, c("SEQN", "GLU_index")]
# Add GLU_index to metadata.
demog_glu <- merge(x=SEQN_GLU, y=demog, all.x=TRUE, by="SEQN")
# Now, it has GLU_index.
head(demog_glu, 2)
# Put 'X' in front of the SEQN and define it as rownames.
rownames(demog_glu) <- paste("X", demog_glu$SEQN, sep="")
# Prep metadata for generating a phyloseq object.
PrepMeta_NHANES(data= demog_glu)
# Food tree
# Load foodtree file generated by the MakeFoodTree function.
foodtree <- read_tree("Foodtree/Food_D12_FC_cc_f_males50s_red_Lv4.nwk")
# Format the food tree and save it as 'TREE'.
PrepTree(data=foodtree)
# ---------------------------------------------------------------------------------------------------------------
# Make a phyloseq object with OTU, TAX, samples, and foodtree by using the phyloseq function.
phyfoods <- phyloseq(OTU, TAX, SAMPLES, TREE)
# Check your metadata
# Show the sample names. Change n to adjust the number of rows to show.
head(sample_names(phyfoods), n=6)
# Show metadata.
head(sample_data(phyfoods), n=2)
# Show only the columns (variables) of metadata.
sample_variables(phyfoods)
# Check the level 1 foods in your food tree
L1s <- tax_table(phyfoods)[, "L1"]
as.vector(unique(L1s))
# Change to the folder called "Ordination" in your "Ordination" folder.
# SpecifyDataDirectory(directory.name = "eg_data/NHANES/Laboratory_data/Ordination/")
SpecifyDataDirectory(directory.name = "~/GitHub/R_Toolbox/Beta-diversity/PCA/")
# PCA via phyloseq. "RDA" with no restrictions is PCA.
nh_rda <- phyloseq::ordinate(phyfoods, "RDA")
nh_rda$values$Relative_eig
# Plot a scree plot
phyloseq::plot_scree(nh_rda) +
geom_bar(stat="identity", fill = "blue") +
labs(x = "\nAxis", y = "Proportion of Variance\n")
# plot_ordination
phyloseq::plot_ordination(phyfoods, nh_rda, type="samples", color="GLU_index") +
geom_point(size = 2) +
stat_ellipse(aes(group = GLU_index), linetype = 2)
# plot_ordination
phyloseq::plot_ordination(phyfoods, nh_rda, type="samples", color="GLU_index") +
geom_point(size = 2)
# Generate a distance matrix
nh_rda_dist <- phyloseq::distance(phyfoods, method = "euclidean")
nh_rda_dist
# Dispersion test and plot
# vegan::betadisper computes centeroids and distance of each datapoint from it.
rda_dispr <- vegan::betadisper(nh_rda_dist, phyloseq::sample_data(phyfoods)$GLU_index)
rda_dispr
anova(rda_dispr)
# ADONIS tests whether there is a difference between groups' composition.
# i.e., composition among groups (food they consumed) is similar or not.
vegan::adonis(nh_rda_dist ~ phyloseq::sample_data(phyfoods)$GLU_index)
phyfoods
otu_table(phyfoods)
head(otu_table(phyfoods))
head(tax_table(phyfoods))
head(sample_data(phyfoods))
nh_rda
summary(nh_rda)
head(summary(nh_rda),1)
nh_rda$values
nh_rda$colsum
View(nh_rda)
install.packages("microbiome")
BiocManager::install("microbiome")
library(microbi)
# CLR transform
phyfoods_clr <- microbiome::transform(phyfoods, "clr")
# PCA via phyloseq. "RDA" with no restrictions is PCA.
nh_rda_asis <- phyloseq::ordinate(phyfoods, "RDA")
# Plot a scree plot
phyloseq::plot_scree(nh_rda_asis) +
geom_bar(stat="identity", fill = "blue") +
labs(x = "\nAxis", y = "Proportion of Variance\n")
# plot_ordination
phyloseq::plot_ordination(phyfoods, nh_rda_asis, type="samples", color="GLU_index") +
geom_point(size = 2) +
stat_ellipse(aes(group = GLU_index), linetype = 2)
# CLR transform
phyfoods_clr <- microbiome::transform(phyfoods, "clr")
# PCA via phyloseq. "RDA" with no restrictions is PCA.
nh_rda_clr <- phyloseq::ordinate(phyfoods_clr, "RDA")
# Plot a scree plot
phyloseq::plot_scree(nh_rda_clr) +
geom_bar(stat="identity", fill = "blue") +
labs(x = "\nAxis", y = "Proportion of Variance\n")
# plot_ordination
phyloseq::plot_ordination(phyfoods_clr, nh_rda_clr, type="samples", color="GLU_index") +
geom_point(size = 2) +
stat_ellipse(aes(group = GLU_index), linetype = 2)
# Generate a distance matrix
nh_rda_dist_clr <- phyloseq::distance(phyfoods_clr, method = "euclidean")
# Dispersion test and plot
# vegan::betadisper computes centeroids and distance of each datapoint from it.
rda_dispr <- vegan::betadisper(nh_rda_dist_clr, phyloseq::sample_data(phyfoods_clr)$GLU_index)
rda_dispr
anova(rda_dispr)
anova(rda_dispr)
anova(rda_dispr)
# ADONIS tests whether there is a difference between groups' composition.
# i.e., composition among groups (food they consumed) is similar or not.
vegan::adonis(nh_rda_dist_clr ~ phyloseq::sample_data(phyfoods_clr)$GLU_index)
# ADONIS tests whether there is a difference between groups' composition.
# i.e., composition among groups (food they consumed) is similar or not.
vegan::adonis(nh_rda_dist_clr ~ phyloseq::sample_data(phyfoods_clr)$GLU_index)
# ADONIS tests whether there is a difference between groups' composition.
# i.e., composition among groups (food they consumed) is similar or not.
vegan::adonis(nh_rda_dist_clr ~ phyloseq::sample_data(phyfoods_clr)$GLU_index)
# ADONIS tests whether there is a difference between groups' composition.
# i.e., composition among groups (food they consumed) is similar or not.
vegan::adonis(nh_rda_dist_clr ~ phyloseq::sample_data(phyfoods_clr)$GLU_index)
setwd("~/GitHub/dietary_patterns")
source("lib/PCA.R")
